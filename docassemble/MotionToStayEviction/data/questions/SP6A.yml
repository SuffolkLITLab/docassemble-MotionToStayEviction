---
include:
  - docassemble.AssemblyLine:assembly_line.yml 
  - docassemble.ALAffidavitOfIndigency:affidavit_body.yml
  - docassemble.AffidavitOfIndigencySupplement:affidavit_of_indigency_supplement_body.yml
  - docassemble.EFSPIntegration:efiling_integration.yml
  - docassemble.EFSPIntegration:login_qs.yml
  - docassemble.EFSPIntegration:case_search.yml
  - docassemble.MassAccess:massaccess.yml
  - docassemble.MassAppealsCourt:appeals-basic-questions.yml
  - efiling.yml
  - NOA.yml
  - docassemble.MassAppealsCourt:efiling.yml
---
metadata:
  title: Appeal or Stay Your Eviction
---
code: |
  bcc_failsafe = "cc@example.com"
---
code: |
  jurisdiction_id = 'massachusetts'
---
code: |
  al_form_type ="appeal"
---
code: |
  proxy_conn = ProxyConnection(credentials_code_block='tyler_login', default_jurisdiction=jurisdiction_id)
---
code: |
  interview_short_title = "Ask the Appeals Court to Stop Your Eviction"
---
code: |
  logged_out_interview = 'docassemble.MassAccess:efile-account-interview.yml'
---
code: |
  admin_interview = "docassemble.EFSPIntegration:admin_interview.yml"
---
objects:
  - lower_court_case: DAObject
---
objects:
  - housing_case_search: EFCaseSearch
  - appeals_case_search: EFCaseSearch
---
#code: |
#  housing_case_search.court_id = housing_case_search.trial_court # court_from_docket_number(lower_court_case.docket_number)
#---
id: housing trial court
question: |
  Which court was your housing case in?
fields:
  - Court Location: housing_case_search.court_id
    datatype: dropdown
    code: |
      [opt for opt in trial_court_options if ('Housing' in opt[1] or 'Superior' in opt[1]) and opt[0] != 'hc']
---
only sets: efile_setup
# Override, don't bother getting the court id before this
code: |
  efile_setup = 'appeals' in available_efile_courts
---
code: |
  appeals_case_search.court_id = all_courts.courts_from_docket_number(appeals_court_docket_number)[0].tyler_code
---
objects:
  - exhibit_doc: ALExhibitDocument.using(title="Exhibits", filename='exhibits', bates_prefix="EX-", include_exhibit_cover_page=True, include_table_of_contents=True, add_page_numbers=True, auto_ocr=True)
---
sections:
  - review_case_info: Case Information
  - review_stay: Motion to Stay Eviction
  - review_indigency: Affidavit of Indigency
  - review_indigency_supplement: Affidavit of Indigency Supplement
  - review_efile_info: Complete Forms
---
id: interview order
mandatory: True
code: |
  nav.set_section('review_case_info')
  user_role = "defendant"
  appeals_basic_questions_intro_screen
  info_screen
  if can_check_efile:
    tyler_login

  # TODO(brycew):
  # lookup appeals court case
  # TODO(brycew):
  # * lookup housing court case
  # * add LowerCourt info in EFSP and finalize var names
  # * reorder questions
  if can_check_efile:
    efile_case_category
    efile_case_type
    if not is_initial_filing:
      appeals_case_search.do_what_choice = 'docket_lookup'
      appeals_case_search.case_was_found
      lower_court_case.docket_number = appeals_case_search.found_case.docket_number
      target_case = appeals_case_search
      add_existing_users
    
    if is_initial_filing:
      housing_case_search.do_what_choice
      housing_case_search.case_was_found
      lower_court_case.docket_number = housing_case_search.found_case.docket_number
      target_case = housing_case_search
      add_new_existing_users
    lower_court_case.judge
  else:
    housing_court
    lower_court_case.docket_number
    lower_court_case.judge

  if forty_eight_hour_notice:
    eviction_date
    eviction_time

  user_ask_role
  nav.set_section('review_stay')
  lower_court_case.judgment_date
  lower_court_case.judgment_appealing
  date_housing_court_denied_motion_to_stay
  housing_court_denying_order_text

  users[0].name.first
  users[0].address.address
  users[0].mobile_number
  users[0].complete
  user_needs_interpreter
  users.there_is_another = False
  users.gathered = True
  plaintiff_name

  # Copy plaintiff name into the "Other Parties" list
  other_parties.auto_gather=False
  other_parties[0].name.first = plaintiff_name
  other_parties.gathered=True
  other_parties[0].complete
  
  defendant_name

  if is_initial_filing:
    if can_check_efile:
      lower_court_case.title = housing_case_search.found_case.title
    else:
      lower_court_case.title = f"{plaintiff_name} vs {defendant_name}"
    docket_numbers[0] = "Case being filed"
  if no_notice_of_appeal_filed:
    noa_variables
    noa_confirmation
  else:
    explain_need_affidavit
  # WARNING: file size error is not currently translatable
  file_size_vars
  has_evidence = exhibit_doc.exhibits.has_exhibits
  if has_evidence:
    exhibit_doc.exhibits.gather()
    review_exhibits
  procedural_history
  statement_of_facts
  procedural_history
  defendant_harm
  plaintiff_harm
  public_interest_harm_yesno
  legal_issues
  relief_sought 
  likelihood_of_success
  argument_summary
  method_of_service
  parties_to_be_served
  service_date
  trial_court = housing_court
  if can_check_efile:
    motion_to_stay_bundle.completed
    lead_contact = users[0]
    # TODO(brycew): hack until Tyler responsd
    trial_court.court_id = trial_court.tyler_code if hasattr(trial_court, 'tyler_code') and trial_court.tyler_code else ''
  if is_initial_filing:
    nav.set_section('review_indigency')
    indigency_intro
    fees['Filing fee'].waive = True
    fees['Filing fee'].amount = 315.00
    ask_affidavit_questions
    if is_indigent:
      if needs_supplement:
        indigency_supplement_intro
        nav.set_section('review_indigency_supplement')
        interview_order_affidavit_of_indigency_supplement
      if can_check_efile:
        nav.set_section('review_efile_info')
        tyler_payment_id = get_config('efile proxy', {}).get('global waivers', {}).get('massachusetts', '')
        affidavitofindigency_attachment.completed
    else:
      doesnt_qualify_interstitial
  nav.set_section('review_efile_info')
  if can_check_efile:
    tyler_payment_id
    ready_to_efile
  users[0].pronouns
  preview_screen
  basic_questions_signature_flow
  users[0].signature
  download
---
code: |
  add_existing_users
  users.gathered = True
  other_parties.gathered = True
  for user in users:
    user.is_new = True
    del user.tyler_id
    del user.party_type
  other_parties.gathered = True
  for other_party in other_parties:
    other_party.is_new = True
    del other_party.tyler_id
    del other_party.party_type
  add_new_existing_users = True
---
code: |
  if is_initial_filing:
    all_party_type_options, all_party_type_map = \
      choices_and_map(proxy_conn.get_party_types(housing_case_search.court_id, None).data)
  else:
    all_party_type_options, all_party_type_map = \
      choices_and_map(proxy_conn.get_party_types(appeals_case_search.court_id, None).data)
---
code: |
  if is_initial_filing:
    target_case = housing_case_search
  else:
    target_case = appeals_case_search
---
code: |
  def is_housing_plaintiff_party(p):
    # TODO(brycew)
    return 'defendant' in p.party_type_name.lower() 

  def is_housing_defendant_party(p):
    return 'plaintiff' in p.party_type_name.lower()
    
  if user_role == 'plaintiff':
    is_user_party = is_housing_plaintiff_party
    is_other_party = is_housing_defendant_party
  else:
    is_user_party = is_housing_defendant_party
    is_other_party = is_housing_plaintiff_party
---
code: |
  max_mb_per_file = 15
  file_size_vars = True
---
id: noa confirmation
question: |
  Here is what your Notice of Appeal looks like.
subquestion: |
  ${ notice_of_appeal.as_pdf(key='preview') }
  
  You will have a chance to add your signature to this document and download it at the end of this interview.
  
  Failure to file a Notice of Appeal in the ${ housing_court } may result in your Motion to Stay being denied.

  % if can_check_efile:
  **Note**: the Notice of Appeal with **not** be e-filed for you. You must file it yourself.
  % endif
continue button field: noa_confirmation
---
generic object: DAObject
question: |
  Would you like to send anyone a copy of your ${ x.title } by email?
fields:
  - I would like to send someone a copy: x.has_courtesy_copies
    datatype: yesnoradio
  - What emails do you want to send to? (one per line): x.courtesy_copies_raw
    datatype: area
    show if: x.has_courtesy_copies
---
id: info screen
question: |
  Motion to Stay Eviction
subquestion: |
  If a trial court judge has ordered you to be evicted, use this form to appeal the trial court judge's order and ask the appeals court to prevent your eviction. 
  
  Before using this form, you must ask for a Stay in the Housing Court.
    
  If you have not already done so, you can use this form to download a Notice of Appeal and file a Waiver of Appeal Bond. 
  
  To use this form, you will need relevant Housing Court documents including:
  
    * the Housing Court's docket
    * the complaint
    * your answer
    * the judgment
    * filings related to your motion to stay in the Housing Court
  
  This form cannot be directly emailed to the Supreme Judicial Court. For more information, contact the Supreme Judicial Court Clerk's office: [(617) 557-1020](tel:+16175571020).
  
  For more information on what you need to file an appeal, view the [Housing Appeal Guide](https://www.mass.gov/guides/housing-appeals-guide#-automatic-stay-pending-appeal-).
continue button field: info_screen
---
objects:
  - users: ALPeopleList.using(there_are_any=True)
---
id: housing court division 
question: | 
  Select the **Housing Court** department and division where your case was heard.
fields:
  - no label: housing_court
    datatype: object
    choices: valid_housing_courts
--- 
code: |
  valid_housing_courts = all_courts.filter_courts(["Housing Court"])
  if can_check_efile and defined('housing_case_search.found_case'):
    valid_housing_courts = [court for court in valid_housing_courts if court.tyler_code == housing_case_search.found_case.court_id]
    if len(valid_housing_courts) == 1:
      housing_court = valid_housing_courts[0]
---
id: housing court docket number 
question: |
  What is the **Housing Court** docket number for your case?
fields:
  - Docket number: lower_court_case.docket_number
--- 
id: appeals court docket number 
question: |
  Is this Motion to Stay the first document you are filing in the **Appeals Court**?
fields:
  - no label: is_initial_filing
    datatype: yesnoradio
  - What is the **Appeals Court** docket number for your case?: appeals_court_docket_number
    show if:
      variable: is_initial_filing
      is: False
---
id: explain_need_affidavit
question: |
  You may qualify for a fee waiver.
subquestion: |
  There is a filing fee to file a Motion to Stay, but you may qualify 
  to get the fees waived.
  
  We will ask you questions to help you find out a little later.
continue button field: explain_need_affidavit
---
id: explain affidavit of indigency
continue button field: indigency_intro
question: |
  Fee waiver questions
subquestion: |
  The next questions will be used to find out if you
  qualify for a fee waiver. The fee to file a Motion to Stay
  is $315.00.
---
id: explain affidavit of indigency
continue button field: indigency_supplement_intro
question: |
  Fee waiver supplement questions
subquestion: |
  The next questions will ask for more detailed information
  about your financials, which will fill out the fee waiver
  supplement application.
---
id: qualify on face
continue button field: qualify_interstitial
question: |
  % if needs_supplement:
  You need to submit a supplemental affidavit to learn if you qualify
  % else:
  Based on your answers, it looks like you qualify for a fee waiver
  % endif
subquestion: |
  % if public_assistance_kinds.any_true():
  Based on the information you gave us so far, you should qualify for a fee
  waiver. Learn more at [MassLegalHelp.org](https://www.masslegalhelp.org/what-if-the-clerk-does-not-approve-my-affidavit-of-indigency-right-away-).
  
  You receive these public benefits: ${public_assistance_kinds.true_values()}
  % elif household_income_qualifies:
  Based on the information you gave us so far, you should qualify for a fee
  waiver. Learn more at [MassLegalHelp.org](https://www.masslegalhelp.org/what-if-the-clerk-does-not-approve-my-affidavit-of-indigency-right-away-).
  
  **You earn less than the income limit.**

  You said that your ${income_period(hh_income.period).lower()} income
  is ${currency(hh_income.amount(period_to_use=hh_income.period))}.
  
  The limit for a household of ${nice_number(household_size)} is 125% of
  the poverty level, or ${currency(household_income_limit/hh_income.period)}.
  % elif not can_afford:
  You told us that you can't afford to pay the fees and pay for the necessities
  of life. A judge will take a closer look at your income and expenses and decide
  if you qualify for sure.
  
  On the next screens, you will complete the supplemental affidavit, and package it.
  % endif
  
  On the next screen, we'll ask you about the specific fees you want waived.
help: |
  If you get certain public benefits, or if you earn less than 125% of 
  the federal poverty level, the law says that you qualify for a fee waiver.
  If you earn more than that but still cannot afford to pay the costs
  of going to court, you need to give the court more information. If the 
  court agrees, they may waive your court costs. It is up to a judge to 
  decide.
  
  * [What if the clerk does not approve my affidavit right away?](https://www.masslegalhelp.org/what-if-the-clerk-does-not-approve-my-affidavit-of-indigency-right-away-)
  * [What if the clerk denies my affidavit?](https://www.masslegalhelp.org/what-if-the-clerk-denies-my-affidavit-of-indigency-)
---
id: plaintiff
question: |
  Who is the **{plaintiff}** in your Housing Court case? 
subquestion: |
  If there is more than one plaintiff, you may enter more than one name.
fields:
  - Plaintiff(s): plaintiff_name
    input type: area 
    rows: 6
terms:
  plaintiff: |
    This could be your landlord or the current owner of the property, such as a foreclosing bank or purchaser. 
--- 
code: |
  if user_role == 'plaintiff':
    plaintiff_name = users.full_names()
    defendant_name = other_parties.full_names()
  else:
    plaintiff_name = other_parties.full_names()
    defendant_name = users.full_names()
---
id: defendant
question: |
  Who is the **defendant** in your Housing Court case?
subquestion: |
  If you are a defendant, please be sure to include yourself.
  
  If there are defendants other than you, you may enter more than one name.
fields:
  - Defendant(s): defendant_name
    input type: area 
    rows: 6
---
id: 48 hour notice
question: |
  Have you received a {48-hour notice}?
subquestion: |
  <CENTER>
  [${eviction_notice.show(width='20em')}](${eviction_notice.url_for()})
  </CENTER>
  
  A 48-Hour Notice can look like the one above.
yesno: forty_eight_hour_notice
terms:
  48-hour notice: |
    A notice from the constable or sheriff telling you they will move you out on a certain day and time.
---
objects:
  - eviction_notice: DAStaticFile.using(filename='48_Hour_Notice.png', alt_text='48-Hour Notice')
---
id: 48 hour notice details
question: |
  When is the sheriff or constable planning to evict you?
subquestion: |
  This answer is 48 hours from when you received the {48-Hour Notice}.
fields:   
  - Date: eviction_date
    datatype: date
  - Time: eviction_time
    datatype: time
terms:
  48-hour notice: |
    A notice from the constable or sheriff telling you they will move you out on a certain day and time.
---
id: date of housing court judgment
question: |
  When did the **Housing Court** enter judgment against you?
fields:
  - Date: lower_court_case.judgment_date
    datatype: date
    max: ${ today() }
---
id: name of housing court judge
question: |
  What is the name of the **Housing Court** judge who entered judgment against you?
fields:
  - Name: lower_court_case.judge
---
id: date notice of appeal filed
question: |  
  When did you file a Notice of Appeal in the **Housing Court**?
subquestion: |
  **Before asking for a Motion to Stay, you must first file a Notice of Appeal in the ${ housing_court }.**
  
  There is no standard form for the Notice of Appeal. Below is a sample.
  
  [${Notice.show(width='28em')}](${Notice.url_for()})
  
    If you have not filed a Notice of Appeal in the ${ housing_court }, you will be directed to do so if you select "I did not file a Notice of Appeal."
fields:
  - I did not file a Notice of Appeal: no_notice_of_appeal_filed
    datatype: yesno
  - Date filed: date_notice_of_appeal_filed
    datatype: date
    max: ${ today() }
    hide if: no_notice_of_appeal_filed
--- 
objects:
  - Notice: DAStaticFile.using(filename='Notice_of_Appeal.png', alt_text='Notice of Appeal')  
---
id: date housing court denied motion to stay
question: |  
  When did the **Housing Court** judge deny your Motion to Stay?
subquestion: |
  Before using this form, you must first ask for a Stay in the ${ housing_court }.
  
  For more information, call the Trial Court’s Emergency HelpLine: 833-91-COURT (833-912-6878) open Monday - Friday from 8:30 am - 4:30 pm. 
    
fields:
  - Date: date_housing_court_denied_motion_to_stay
    datatype: date  
    max: ${ today() }
---
id: housing court judge order text
question: |
  Enter the text of the **Housing Court** judge's order denying your Motion to Stay in the Housing Court.
fields:
  - no label: housing_court_denying_order_text
    input type: area 
    rows: 6
---
id: legal issues raised
question: |
  Select the issues of law in your case.
subquestion: |
  A statement of the issue(s) of law is a brief statement of the legal reason that the single justice should allow your motion to stay.
fields:
  - no label: legal_issues
    datatype: checkboxes
    choices:
      - Whether the judge abused their discretion when they ordered ${ housing_court_denying_order_text }.: Whether the judge abused their discretion when they ordered ${ housing_court_denying_order_text }.
      - Whether the judge committed an error of law when the judge failed to follow the summary process statute (G.L. c. 239, §§1, et seq.).: Whether the judge committed an error of law when the judge failed to follow the summary process statute (G.L. c. 239, §§1, et seq.).
      - Whether the judge committed an error of law by failing to follow the Uniform Summary Process Rules.: Whether the judge committed an error of law by failing to follow the Uniform Summary Process Rules.
      - Whether the judge committed an error of law by allowing the plaintiff to submit evidence that should not have been considered.: Whether the judge committed an error of law by allowing the plaintiff to submit evidence that should not have been considered.
      - Whether the judge committed an error of law by not allowing me to submit evidence that should have been considered.: Whether the judge committed an error of law by not allowing me to submit evidence that should have been considered.
      - Whether the judge violated my constitutional right to due process of law.: Whether the judge violated my constitutional right to due process of law.
      - Other: Other
    none of the above: False  
  - Other: other_legal_issues
    show if: legal_issues["Other"]
help:
  label: |
    Examples
  content: |
    * For example, if the Housing Court judge's order is unreasonable in light of the facts that that the judge heard at the hearing or trial, the issue of law would be whether the judge's order was an abuse of discretion.
    * For example, if you thought the judge mistakenly did not allow you to present a piece of evidence at the hearing or trial, the issue of law would be whether the judge improperly excluded evidence at the hearing or trial. 
---
id: relief_sought
question: |
  What are you asking for?
subquestion: |
  Be as specific as possible.
fields:
  - no label: relief_sought
    input type: area
    rows: 6
--- 
id: method of service
question: |
  How will you deliver the required copies of the motion, memorandum, and supporting materials to the plaintiffs' attorney(s)?
subquestion: |
  You are required to provide a copy of this motion, memorandum, and supporting materials to the plaintiffs' attorney(s).
  
  If the plaintiff does not have an attorney, you are required to serve a copy on the self-represented plaintiff.  
  
  You should not provide a copy of your Affidavit of Indigency, if any, to anyone except the Appeals Court.  
field: method_of_service
dropdown:
  - Efile and serve (efilema.com): efile and serve (efilema.com)
  - Email: email
  - Mail: mail
  - Hand delivery: hand delivery
---
id: parties to be served
question: |
  List the name and address (or email address) of each attorney or self-represented party that you will deliver copies of your motion, memorandum, and supporting materials to.
subquestion: |
  If you are serving more than one attorney or party, you may list more than one.
fields:
  - no label: parties_to_be_served
    input type: area 
    rows: 6
---
id: service date
question: |
  When will you deliver copies of your motion, memorandum, and supporting materials to the plaintiffs' attorney(s)?
subquestion: |
  You are required to provide a copy of this motion, memorandum, and supporting materials to the plaintiffs' attorney(s).
fields:
  - Date: service_date
    datatype: date  
    min: ${ today() }
---
id: procedural history
question: |
  Describe the events in your **Housing Court** case in the order they happened.
subquestion: |
  This is called the **procedural history**.
  
  Include a list of any motions that you or the plaintiff filed after the judgment was entered.
   
  It is important to describe whether the judgment was:
  
    * entered against you after a default, 
    * on an order for summary judgment, 
    * after a trial, **or**
    * pursuant to an agreement for judgment.  
fields:
  - no label: procedural_history
    input type: area 
    rows: 6
---
id: statement of facts
question: |
  Describe the **facts** of your case.
subquestion: |
  How did your tenancy or former ownership of the property end? Why were you evicted?
  
  This is called the **factual history**.
fields:
  - no label: statement_of_facts
    input type: area 
    rows: 6
help:
  label: |
    Example
  content: |
    For example, if you filed a complaint with your local inspectional services department, describe the complaint including the date it was made and the resolution after the inspection.
---
id: likelihood of success
question: |
  Why is your appeal likely to succeed?  
subquestion: |
  In order to grant your request for a Stay, your motion must show that your appeal is likely to succeed.
fields:
  - no label: likelihood_of_success
    input type: area 
    rows: 6
---
id: harm suffered by defendant 
question: |
  What harm will **you or your dependents** suffer if your Motion to Stay is denied?
subquestion: |
  Your Motion to Stay must show that you or your dependents will suffer irreparable harm if your motion is denied.
fields:
  - no label: defendant_harm
    input type: area 
    rows: 6
---
id: harm suffered by plaintiff 
question: |
  What harm will the **{plaintiff}** suffer if your Motion to Stay is granted?
subquestion: |
  Your Motion to Stay must show that the plaintiff will not be harmed more than you or your dependents if your motion is granted.
fields:
  - no label: plaintiff_harm
    input type: area 
    rows: 6
terms:
  plaintiff: |
    This could be your landlord or the current owner of the property, such as a foreclosing bank or purchaser.  
---
id: public interest harm yesno
question: |
  Does your Motion to Stay have an effect on the **{public interest}**?
subquestion:  |
  Your motion must show that the stay does not harm the public interest.

  ${ collapse_template(public_interest_explainer)}

fields:
  - no label: public_interest_harm_yesno
    datatype: yesnoradio
  - What effect would your Motion to Stay have on the **public interest**?: public_interest_harm
    input type: area 
    rows: 6
    show if: public_interest_harm_yesno
terms:
  public interest: |
    ${ public_interest_explainer }
---
template: public_interest_explainer
subject: What is the "public interest"?
content: |
    The public interest is most often implicated:
    
    * in cases involving a federal subsidy ("section 9 voucher") 
    
    **OR** 
    
    * if you are a tenant in public housing and your eviction was caused by a breach of your lease other than failure to pay rent. 
---
id: argument summary
question: |
  Summarize your argument
subquestion: |
  Most Motions to Stay are decided without holding a hearing.  
  
  It is important that you include in your Motion to Stay anything that you want the court to know about your case.
fields:
  - no label: argument_summary
    input type: area 
    rows: 6
---
code: |
  case_name = lower_court_case.title
---
code: |
  motion_to_stay_bundle.enabled = True
  general_cover_sheet.enabled = not can_check_efile
  notice_of_appeal.enabled = no_notice_of_appeal_filed
---
code: |
  affidavitofindigency_attachment.enabled = is_initial_filing and is_indigent
---
code: |
  affidavit_of_indigency_supplement_attachment.enabled = is_initial_filing and is_indigent and needs_supplement
---
id: review before signature
continue button field: preview_screen
question: |
  Nearly finished
subquestion: |
  You are almost done! Please click on the form below. It will open in a new window so you can review it and make sure it is correct.
  
  Do not forget to come back to this page to click to the final step of signing and sending the form to the court. 
  
   ${ al_user_bundle.as_pdf(key="preview") }

progress: 95
---
if: |
  not ready_to_efile
id: download form
event: download
decoration: file-download
question: |
  Download Form
subquestion: |
  Thank you ${users[0]}. Your form is ready to download. 
  
  % if no_notice_of_appeal_filed:
  **You have two documents to download:** 
  
  1. The [:file-download: Notice of Appeal]( ${ notice_of_appeal['final'].pdf.url_for()} ),
  which needs to be delivered to the **${ housing_court }**. You need to deliver
  this on your own. Call the ${ housing_court } at ${ housing_court.phone }
  to find out how.
  2. Your Appeal, which needs to be delivered to ${ appeals_court }. You can deliver it to the Appeals Court in
  person or through e-filing.
  % if not user_wants_efile:
  You indicated that you didn't want to e-file this document in this interview. You will have to restart this process if you
  wish to e-file it.
  % endif

  % endif
  
  1. Click the preview image below to open the form in a new window.
  1. Download and save or print a copy of this form for your 
  records.
  
  The Appeals Court Clerk's Office number is 617-921-4443 
  
  The Appeals Court Clerk's Office is open:

  Monday - Friday

  8:30am - 4:30pm

  ${ al_user_bundle.download_list_html() }
  
progress: 100
section: download
---
if:
  ready_to_efile
id: download form
event: download
decoration: file-download
question: |
  % if not defined('email_success') or not email_success:
  Review, Download, and Send Form
  % else:
  Form delivered
  % endif
subquestion: |
  % if not defined('email_success') or not email_success:
  Thank you ${users[0]}. Your form is ready to send to the court. **It is not
  delivered until you complete the delivery process below.**
  
  % if no_notice_of_appeal_filed:
  **You have two documents to deliver:** 
  
  1. The [:file-download: Notice of Appeal]( ${ notice_of_appeal['final'].pdf.url_for()} ),
  which needs to be delivered to the **${ housing_court }**. You need to deliver
  this on your own. Call the ${ housing_court } at ${ housing_court.phone }
  to find out how.
  2. Your Appeal, which needs to be delivered to ${ appeals_court }. You can deliver the appeal by following the steps below.
  
  Follow these steps to deliver the Appeal to the ${ appeals_court }:
  % endif
  
  1. Click the preview image below to open the form in a new window.
  1. Download and save or print a copy of this form for your 
  records.
  1. Click "Submit to ${ appeals_court }" to send it to the court. 
  1. You will have a chance to add instructions to the clerk and see the cover page before final delivery.
  % else:
  If you do not hear from the court in 1 business day, call the   Appeals Court Clerk's Office: 617-921-4443 
  
  The Appeals Court Clerk's Office is open:

  Monday - Friday

  8:30am - 4:30pm
  % endif

  % if not (defined('efile') and efile):
  
  Click the "E-File" button below to e-file your form.
  
  ${ action_button_html(url_ask([{'recompute': ['efile']}]), label='E-File', id_tag='efile-button', icon='file-export', size='md')}
  
  % endif
  
  ${ al_user_bundle.download_list_html() }
  
comment: |
  % if ready_to_efile and not (defined('efile') and efile):
  Click the "E-File" button below to e-file your form at ${ trial_court }.
  ${ action_button_html(url_ask([{'recompute': ['efile']}]), label='E-file', icon='file-export', id_tag='efile', size='md') }
  % elif ready_to_efile and (defined('efile') and efile):
  Your filing has already been delivered to ${ appeals_court }.
  % elif ready_to_efile and (defined('efile') and not efile):
  E-filing was not successful. Call the clerk and try delivering
  the files below a different way.
  % elif not ready_to_efile:
  We are not able to e-file this form. Please call the clerk and try delivering the files
  below a different way.
  % endif
progress: 100
section: download
---
code: |
  if has_evidence:
    if not exhibit_doc.ocr_ready():
      waiting_screen
---
event: waiting_screen
reload: True
question: |
  <i class="fas fa-cog fa-spin"></i> Please wait while we process your documents . . . <i class="fas fa-cog fa-spin"></i>
---
objects:
  - motion_attachment: ALDocument.using(enabled=True, has_addendum=False, title="Display Name of Form", filename="motion-to-stay-eviction")
---
attachment:
  - name: Motion to Stay Eviction
    variable name: motion_attachment[i]
    filename: Motion_To_Stay_Eviction
    docx template file: Motion_To_Stay_Eviction.docx
---
generic object: ALExhibitList
id: record appendix
question: |
  You are required to submit copies of relevant Housing Court documents.
subquestion: |
  Examples include:
  
    * the Housing Court's docket 
    * the complaint
    * your answer
    * the judgment
    * filings related to your motion to stay in the Housing Court.
    
  If you entered into an agreement for judgment, include a copy of the agreement for judgment.
fields:
  - Do you have any documents to share with the judge?: x.has_exhibits
    datatype: yesnoradio
  - I state that filing a complete record appendix is impracticable.: no_record_statement
    datatype: yesno
    show if: 
      variable: x.has_exhibits
      is: False
  - First document title: x[0].title
    maxlength: 60
    show if: x.has_exhibits
  - Tap "browse" and choose all of the documents you want to upload at once. You can edit or add additional documents on the next screen.: x[0].pages 
    datatype: files
    show if: x.has_exhibits
    maximum image size: 1024
    image upload type: jpeg
    accept: |
      "image/*, image/png,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/pdf,.pdf"
validation code: |
  if x.has_exhibits:
    if sum(exhibit.size_in_bytes() for exhibit in x[0].pages) > (15 * 1024 * 1024):
      validation_error("Upload a file smaller than 15 MB.")
    try:
      pdf_concatenate(x[0].pages)
    except:
      validation_error("Unable to convert this file. Please upload a new one.", field="x[0].pages")
    x[0].pages.reset_gathered()  # docassemble sets this attribute but we want to force gathering additional pages
---
table: exhibit_doc.exhibits.table
rows: exhibit_doc.exhibits
allow reordering: True
columns:
  - File name: showifdef(row_item.as_pdf().attr_name('filename'))
  # - Size: row_item.size_in_bytes() / 1024 / 1024
  - Thumbnail: row_item.as_pdf().show(width="100px")
delete buttons: True
---
id: add additional document
question: |
  Exhibit document ${i+1}
fields:
  - no label: exhibit_doc.exhibits[i]
    datatype: file
    accept: |
      "image/*, image/png,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/pdf,.pdf"   
validation code: |
  # Upload field creates a DAFileList
  # We want it to be a plain DAFile instead
  if isinstance(exhibit_doc.exhibits[i], DAFileList):
    temp_name = exhibit_doc.exhibits[i].instanceName
    exhibit_doc.exhibits[i] = next(iter(exhibit_doc.exhibits[i]))
    # Make sure the "instanceName" shows the correct position in the list,
    # instead of showing a nested DAFileList's instanceName
    exhibit_doc.exhibits[i].instanceName = temp_name
---
objects:
  - al_court_bundle: ALDocumentBundle.using(elements=[motion_to_stay_bundle, affidavitofindigency_attachment, affidavit_of_indigency_supplement_attachment], filename="motion_to_stay_eviction", title="Court bundle")
  - al_user_bundle: ALDocumentBundle.using(elements=[motion_to_stay_bundle, notice_of_appeal, affidavitofindigency_attachment, affidavit_of_indigency_supplement_attachment], filename="motion_to_stay_eviction", title="All Your documents")
---
objects:
  - motion_to_stay_bundle: ALDocumentBundle.using(elements=[motion_attachment, exhibit_doc], title="Motion To Stay (Eviction)", filename="motion_to_stay_eviction")
---
objects:
  - general_cover_sheet: ALDocument.using(title="Cover Sheet", filename="cover-sheet")
---
code: |
  general_cover_sheet.enabled = not can_check_efile
---
code: |
  exhibit_doc.enabled = exhibit_doc.exhibits.has_exhibits
---
id: review exhibits
question: |
  Review your exhibits
subquestion: |
  Look at the exhibits below. If you want to change the order, use the arrows
  to move an exhibit up or down in the list. Click "delete" or "add another"
  to change which exhibits you send to the court.
  
  ${ exhibit_doc.exhibits.table }
  
  ${exhibit_doc.exhibits.add_action() }
continue button field: review_exhibits
---
id: email to court
template: email_to_court_template
subject: |
  MassAccess submission from ${ users } intended for ${ appeals_court }
content: |
  % if has_evidence and exhibit_doc.as_pdf('final').size_in_bytes() > 10 * 1024 * 1024:
  **The user provided an attachment that is too large to email.**
  [Link to exhibits](${ exhibit_doc.as_pdf('final').url_for(external=True) } )
  % endif
  
  At ${current_datetime().format_datetime()},
  ${users} submitted the attached ${package_title} form(s).

  &nbsp;        | &nbsp;
  --------------|-----------
  Date of email | ${current_datetime().format_datetime()}
  Pages | ${ al_court_bundle.as_pdf('final').num_pages() }  
  Preferred language | ${ user_preferred_language if user_needs_interpreter else 'English' }
  Mobile phone | ${showifdef('users[0].mobile_number')}
  Other phone | ${showifdef('users[0].phone_number')}
  Email | ${showifdef('users[0].email')}
  Contact details/other | ${showifdef('users[0].other_contact_method')}
  
  Comments for clerk: 
  
  ${ showifdef('comments_to_clerk')}
  
  Please contact ${users} in the next business day to
  confirm that you received this message.
---
attachment:
  variable name: general_cover_sheet[i]
  filename: cover-sheet.docx
  docx template file: general_cover_sheet.docx