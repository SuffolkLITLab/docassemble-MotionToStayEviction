---
include:
  - docassemble.EFSPIntegration:codes_helper.yml
---
code: |
  trial_court_resp = proxy_conn.get_courts(with_names=True)
  trial_court_options = sorted([(court['code'], court['name']) for court in trial_court_resp.data or []], key=lambda c: c[1])
  trial_court_map = {court['code']: court['name'] for court in trial_court_resp.data or []}
---
generic object: ALDocumentBundle
code: |
  x.optional_services.there_are_any = False
---
generic object: DAObject
code: |
  x.filing_description = f'The completed Motion to Stay Eviction for {users[0].name}'
  x.reference_number = None
  x.filing_parties = ['users[0]']
  x.filing_action = 'efile'
---
code: |
  motion_to_stay_bundle.filtered_filing_options, motion_to_stay_bundle.filing_type = \
      filter_codes(filing_type_options,
          ['Motion to stay a judgment MRAP 6(a)', 'MRAP 6(a)'], '6553')
  if motion_to_stay_bundle.filing_type is None:
    motion_to_stay_bundle.filing_type = motion_to_stay_bundle.user_chosen_filing_type
---
code: |
  affidavitofindigency_attachment.filtered_filing_options, affidavitofindigency_attachment.filing_type = \
      filter_codes(filing_type_options,
          ['Indigency Affidavit'], '8411')
  if affidavitofindigency_attachment.filing_type is None:
    affidavitofindigency_attachment.filing_type = affidavitofindigency_attachment.user_chosen_filing_type
---
code: |
  efile_case_category_filters = ['Appeals Court Single Justice - Civil', 'Civil']
  efile_case_category_default = '8151'
  efile_case_type_filters = ['Motion for stay of judgment MRAP 6(a)', 'MRAP 6(a)']
  efile_case_type_default = '8157'
---
code: |
  if not is_initial_filing and 'P' in appeals_court_docket_number:
    court_id = 'appeals:acp'
  else:
    court_id = 'appeals:acsj'
---
code: |
  users[i].party_type_options, users[i].party_type = filter_codes(party_type_options,
      ['Defendant/Appellant', 'Defendant/Petitioner'], '1729')
  if users[i].party_type is None:
    users[i].party_type = users[i].user_chosen_party_type
---
code: |
  other_parties[i].party_type_options, other_parties[i].party_type = filter_codes(party_type_options,
      ['Plaintiff/Appellee', 'Plaintiff/Respondent'], '1736')
  if other_parties[i].party_type is None:
    other_parties[i].party_type = other_parties[i].user_chosen_party_type
---
generic object: DAObject
id: user chosen filing_type
question: |
  What is the filing type of this filing?
subquestion: |
  We found a few filing codes that could be used to file your fee waiver. Choose the one that you think best fits your case.
fields:
  - Filing type: x.user_chosen_filing_type
    datatype: dropdown
    code: |
      x.filtered_filing_options
---
# TODO(brycew): eventually add back attorney ids
generic object: ALIndividual
code: |
  if hasattr(x, 'existing_attorney_ids'):
    x.attorney_ids = x.existing_attorney_ids
  else:
    x.attorney_ids = []
---
id: you-will-not-be-able-to-efile
question: |
  You will *not* be able to efile this document
subquestion: |
  Unfortunately, you won't be able to efile this document at the Appeals Court.

  However, you are still be able to continue and download a completed form.
continue button field: show_no_efile
---
generic object: EFCaseSearch
template: x.docket_lookup_choice
content: |
  Docket number
---
template: housing_case_search.case_number_format_template
subject: What does my housing docket number look like?
content: |
  The docket number is a number that the court assigns your case.

  The housing court docket number will usually similar to this:

  15H84CV000436

  It has 5 parts:
  
  * the first 2 numbers, "15" are the case's filing year
  * the third letter is always an "H" in the housing courts
  * the next two numbers, "84", are the housing court "code" and refer to a speific court
  * the next two letters, "CV", are the case-type code
  * the last 6 numbers, "000436", are the case's sequence number
---
reconsider:
  - tyler_payment_account_options
id: payment account
question: |
  Payment Account
subquestion: |
  Select an existing account below, or add a payment account
  using the 
  [eFileMA site](https://massachusetts.tylerhost.net/ofsweb/){:target="_blank"}
  
  Refresh this page when you have finished adding the account.
fields:
  - Payment Account: tyler_payment_id
    datatype: dropdown
    code: |
      tyler_payment_account_options
---
code: |
  allowable_card_types = full_court_info.get('allowablecardtypes', [])
  res = proxy_conn.get_payment_account_list().data
  if res:
    tyler_payment_account_options = filter_payment_accounts(res, allowable_card_types)
  else:
    tyler_payment_account_options = []
  if not tyler_payment_account_options:
    payment_kickout
---
event: payment_kickout
question: |
  You need to add a payment account
subquestion: |
  Add a payment account using the
  [eFileMA site](https://massachusetts.tylerhost.net/ofsweb/){:target="_blank"}.

  Refresh this page when you have added a new payment account.